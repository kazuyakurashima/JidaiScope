# 033: Source/å…¸æ‹  Displayï¼ˆSprint 3ï¼‰

## æ¦‚è¦

**ç›®çš„:** ã‚¤ãƒ™ãƒ³ãƒˆè©³ç´°ç”»é¢ã«å‡ºå…¸æƒ…å ±ã‚’å°ãƒ•ã‚©ãƒ³ãƒˆã§è¡¨ç¤ºã—ã€æ•™è‚²çš„ä¿¡é ¼æ€§ã‚’ç¢ºä¿

**ã‚¹ã‚³ãƒ¼ãƒ—:**

- MVP ã§ã¯ä¸»è¦100ä»¶ã®ã‚¤ãƒ™ãƒ³ãƒˆã« source ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¨­å®š
- SourceBadge ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆ10px, ç°è‰²ï¼‰
- å‡ºå…¸ã‚¿ã‚¤ãƒˆãƒ«ã€ãƒšãƒ¼ã‚¸ç•ªå·ã€å‚è€ƒURL
- URL ã‚¿ãƒƒãƒ—ã§ãƒ–ãƒ©ã‚¦ã‚¶é–‹ã

**æˆåŠŸåŸºæº–:**

- âœ… 100ä»¶ã®ã‚¤ãƒ™ãƒ³ãƒˆã« source ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¨­å®šå®Œäº†
- âœ… SourceBadge ãŒ 10px ç°è‰²ã§è¡¨ç¤º
- âœ… å‡ºå…¸ãŒãªã„å ´åˆã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³éè¡¨ç¤º
- âœ… URL ãŒã‚ã‚‹å ´åˆã€ã‚¿ãƒƒãƒ—ã§ Linking.openURL()

---

## ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼

```
As a é«˜æ ¡æ•™å¸«
I want to ã‚¢ãƒ—ãƒªã®æƒ…å ±ãŒã©ã“ã‹ã‚‰å‡ºã¦ããŸã®ã‹å‚è€ƒæ–‡çŒ®ã‚’ç¢ºèªã—ãŸã„
So that ã‚¯ãƒ©ã‚¹ã§ä¿¡é ¼ã§ãã‚‹æƒ…å ±æºã ã¨ç´¹ä»‹ã§ãã‚‹
```

---

## å—ã‘å…¥ã‚Œæ¡ä»¶

| #   | æ¡ä»¶                                              | æ¤œè¨¼æ–¹æ³•           | æ‹…å½“ |
| --- | ------------------------------------------------- | ------------------ | ---- |
| 1   | MVP 100ä»¶ã®ã‚¤ãƒ™ãƒ³ãƒˆã« source ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¨­å®š       | Event ãƒ†ãƒ¼ãƒ–ãƒ«ç¢ºèª | -    |
| 2   | SourceBadge UI ãŒ 10px, #718096 ã§è¡¨ç¤º            | ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ç¢ºèª     | -    |
| 3   | source.url ãŒã‚ã‚‹å ´åˆã€ã‚¿ãƒƒãƒ—ã§ ãƒ–ãƒ©ã‚¦ã‚¶ æ‰“ã¡é–‹ã | å®Ÿæ©Ÿãƒ†ã‚¹ãƒˆ         | -    |
| 4   | source ãŒ null ã®å ´åˆã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³éè¡¨ç¤º           | è©³ç´°ç”»é¢ã§ç¢ºèª     | -    |
| 5   | v1.1 ã§ã®å…¨ä»¶å¯¾å¿œè¨ˆç”»ã‚’ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåŒ–             | ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—ç¢ºèª   | -    |

---

## ä¾å­˜é–¢ä¿‚

| ç¨®é¡             | è©³ç´°                                                                   |
| ---------------- | ---------------------------------------------------------------------- |
| âœ“ å…¥åŠ›ä¾å­˜       | 013 (Database - Event ãƒ†ãƒ¼ãƒ–ãƒ«ã« source 100ä»¶è¨­å®š), 031 (Event Detail) |
| âœ— ã‚³ãƒ¼ãƒ‰ä¾å­˜     | 031 ã® SourceBadge ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆçµ±åˆ                                  |
| âœ— ä»–ãƒã‚±ãƒƒãƒˆä¾å­˜ | ãªã—                                                                   |

---

## ãƒ‡ãƒ¼ã‚¿ä»•æ§˜

### Event.source ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆPRD ã‚»ã‚¯ã‚·ãƒ§ãƒ³ 10.2ï¼‰

```typescript
interface Event {
  // ... ãã®ä»–ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
  source?: {
    title: string; // å‡ºå…¸åï¼š"å±±å· è©³èª¬æ—¥æœ¬å²", "æ—¥æœ¬å²B æ•™ç§‘æ›¸" ç­‰
    page?: string; // ãƒšãƒ¼ã‚¸ç•ªå·ï¼š"p.124", "pp.50-51" ç­‰ (ä»»æ„)
    url?: string; // å‚è€ƒURL (ä»»æ„)
  };
}
```

### MVP å…¸æ‹ å¯¾è±¡ã®é¸å®šåŸºæº–ï¼ˆPRD ã‚»ã‚¯ã‚·ãƒ§ãƒ³ 10.3ï¼‰

| å„ªå…ˆåº¦   | åŸºæº–                                       | ä»¶æ•°ç›®å®‰  |
| -------- | ------------------------------------------ | --------- |
| 1        | æ•™ç§‘æ›¸ã«å¿…ãšæ²è¼‰ã•ã‚Œã‚‹å‡ºæ¥äº‹               | 50ä»¶      |
| 2        | å…¥è©¦é »å‡ºã‚¤ãƒ™ãƒ³ãƒˆ                           | 30ä»¶      |
| 3        | å› æœé–¢ä¿‚ã®ç†è§£ã«ä¸å¯æ¬ ãªã‚¿ãƒ¼ãƒ‹ãƒ³ã‚°ãƒã‚¤ãƒ³ãƒˆ | 20ä»¶      |
| **åˆè¨ˆ** |                                            | **100ä»¶** |

### å…¸æ‹ ãƒ‡ãƒ¼ã‚¿ä¾‹

```json
{
  "id": "event-001",
  "title": "æ˜æ²»ç¶­æ–°",
  "startDate": "1868-01-25",
  "source": {
    "title": "å±±å· è©³èª¬æ—¥æœ¬å²",
    "page": "p.124",
    "url": "https://yamakawa.co.jp/"
  }
},
{
  "id": "event-002",
  "title": "æœ¬èƒ½å¯ºã®å¤‰",
  "startDate": "1582-06-21",
  "source": {
    "title": "æ—¥æœ¬å²B æ•™ç§‘æ›¸ï¼ˆæ–‡éƒ¨ç§‘å­¦çœï¼‰",
    "page": "pp.88-89"
  }
}
```

---

## Todo ãƒªã‚¹ãƒˆ

### Phase 1: å…¸æ‹ ãƒ‡ãƒ¼ã‚¿åé›†ãƒ»å…¥åŠ›

- [ ] ä¸»è¦100ä»¶ã® ã‚¤ãƒ™ãƒ³ãƒˆé¸å®š
  - [ ] æ•™ç§‘æ›¸ãƒ»å‚è€ƒæ›¸ã‚¹ã‚­ãƒ£ãƒ³
  - [ ] æ­´å²çš„é‡è¦æ€§ãƒ©ãƒ³ã‚¯ä»˜ã‘
- [ ] 100ä»¶ã® Event ãƒ¬ã‚³ãƒ¼ãƒ‰ã« source ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¨­å®š
  - [ ] title: å‡ºå…¸å
  - [ ] page: ãƒšãƒ¼ã‚¸ç•ªå·ï¼ˆã‚ã‚‹å ´åˆï¼‰
  - [ ] url: å‚è€ƒURLï¼ˆã‚ã‚‹å ´åˆï¼‰
- [ ] å…¸æ‹ ãƒ‡ãƒ¼ã‚¿ã®æ­£ç¢ºæ€§ç¢ºèª

### Phase 2: SourceBadge ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå®Ÿè£…

- [ ] SourceBadge.tsx ä½œæˆ
  - [ ] ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚º: 10px
  - [ ] è‰²: #718096 (--text-tertiary)
  - [ ] ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ: source.title + source.page
- [ ] URL ãŒã‚ã‚‹å ´åˆã€Linking.openURL() çµ±åˆ
- [ ] ã‚¿ãƒƒãƒ—é ˜åŸŸç¢ºèªï¼ˆæœ€å° 44ptï¼‰

### Phase 3: Event Detail ç”»é¢ã«çµ±åˆï¼ˆ031 ã¨é€£æºï¼‰

- [ ] EventDetail.tsx ã« SourceBadge ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¿½åŠ 
  - [ ] event.source ã®å­˜åœ¨åˆ¤å®š
  - [ ] ã‚ã‚‹å ´åˆã®ã¿ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¡¨ç¤º
- [ ] 031 ãƒã‚±ãƒƒãƒˆå®Œäº†å¾Œã« çµ±åˆãƒ†ã‚¹ãƒˆ

### Phase 4: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ»ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—

- [ ] v1.1 ã§ã®å…¨ä»¶å¯¾å¿œè¨ˆç”»ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåŒ–
  - [ ] æ®‹ã‚Š 700-800 ä»¶ã®å…¸æ‹ è¿½åŠ ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
  - [ ] å¤–éƒ¨ API/ã‚µãƒ¼ãƒ“ã‚¹é€£æºå€™è£œã®æ¤œè¨
- [ ] å…¸æ‹ ãƒ‡ãƒ¼ã‚¿æ›´æ–°ãƒ•ãƒ­ãƒ¼å®šç¾©

### Phase 5: ãƒ†ã‚¹ãƒˆ

- [ ] 100ä»¶ã® ã‚¤ãƒ™ãƒ³ãƒˆ source å­˜åœ¨ç¢ºèª
- [ ] SourceBadge ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ç¢ºèªï¼ˆ10px, ç°è‰²ï¼‰
- [ ] URL ã‚¿ãƒƒãƒ— â†’ ãƒ–ãƒ©ã‚¦ã‚¶æ‰“ã¡é–‹ã
- [ ] source ãŒ null â†’ ã‚»ã‚¯ã‚·ãƒ§ãƒ³éè¡¨ç¤º

---

## å®Ÿè£…ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

### SourceBadge ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

```typescript
// components/cards/SourceBadge.tsx
import { Linking, Pressable, Text, StyleSheet } from 'react-native';

interface Source {
  title: string;
  page?: string;
  url?: string;
}

interface SourceBadgeProps {
  source: Source;
}

export function SourceBadge({ source }: SourceBadgeProps) {
  const handlePress = async () => {
    if (source.url) {
      try {
        const canOpen = await Linking.canOpenURL(source.url);
        if (canOpen) {
          await Linking.openURL(source.url);
        }
      } catch (error) {
        console.error('URL open failed:', error);
      }
    }
  };

  const text = source.page
    ? `${source.title} - p.${source.page}`
    : source.title;

  return (
    <Pressable
      onPress={handlePress}
      disabled={!source.url}
      style={styles.container}
      hitSlop={{ top: 8, bottom: 8, left: 8, right: 8 }}
    >
      <Text style={styles.text}>
        {text}
        {source.url && ' ğŸ”—'}
      </Text>
    </Pressable>
  );
}

const styles = StyleSheet.create({
  container: {
    marginVertical: 4,
  },
  text: {
    fontSize: 10,
    color: '#718096', // --text-tertiary
    fontFamily: 'Hiragino Sans',
    lineHeight: 14,
  },
});
```

### Event Detail ã¸ã®çµ±åˆ

```typescript
// app/event/[id].tsx (031 ãƒã‚±ãƒƒãƒˆå†…ã§å®Ÿè£…)

import { SourceBadge } from '@/components/cards/SourceBadge';

export default function EventDetailScreen() {
  // ... æ—¢å­˜ã‚³ãƒ¼ãƒ‰

  return (
    <ScrollView>
      {/* ... æ—¢å­˜ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */}

      {/* å…¸æ‹ ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */}
      {event.source && (
        <Section title="å…¸æ‹ ">
          <SourceBadge source={event.source} />
        </Section>
      )}
    </ScrollView>
  );
}
```

### å…¸æ‹ ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

```typescript
// scripts/seed/add_sources.ts
import { openDatabaseAsync } from "expo-sqlite";

// å…¸æ‹ ãƒ‡ãƒ¼ã‚¿é…åˆ—
const SOURCES_DATA = [
  {
    eventId: "event-001",
    source: {
      title: "å±±å· è©³èª¬æ—¥æœ¬å²",
      page: "p.124",
      url: "https://yamakawa.co.jp/",
    },
  },
  // ... 99ä»¶è¿½åŠ 
];

export async function addSourcesToEvents() {
  const db = await openDatabaseAsync("jidaiscope.db");

  for (const { eventId, source } of SOURCES_DATA) {
    await db.runAsync(`UPDATE event SET source = ? WHERE id = ?`, [
      JSON.stringify(source),
      eventId,
    ]);
  }

  console.log(`âœ“ ${SOURCES_DATA.length}ä»¶ã®å…¸æ‹ ã‚’è¨­å®šã—ã¾ã—ãŸ`);
}
```

---

## v1.1 ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—

| ãƒ•ã‚§ãƒ¼ã‚º | å¯¾å¿œç¯„å›²             | ä»¶æ•°      |
| -------- | -------------------- | --------- |
| MVP      | ä¸»è¦ã‚¤ãƒ™ãƒ³ãƒˆ         | 100ä»¶     |
| v1.1     | å…¨ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆæ®µéšçš„ï¼‰ | 500-800ä»¶ |
| v1.2+    | å…¸æ‹ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é€£æº | -         |

**v1.1 ã§ã®å¤–éƒ¨ã‚½ãƒ¼ã‚¹å€™è£œ:**

- æ–‡éƒ¨ç§‘å­¦çœæ•™ç§‘æ›¸ API
- Wikipedia å±¥æ­´æ¤œç´¢
- å›½ç«‹å…¬æ–‡æ›¸é¤¨ãƒ‡ã‚¸ã‚¿ãƒ«ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–
- å­¦è¡“è«–æ–‡DBï¼ˆCiNii ç­‰ï¼‰

---

## ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
components/
â””â”€â”€ cards/
    â””â”€â”€ SourceBadge.tsx          # å…¸æ‹ è¡¨ç¤ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

scripts/
â””â”€â”€ seed/
    â”œâ”€â”€ sources-100.json         # å…¸æ‹ ãƒ‡ãƒ¼ã‚¿
    â””â”€â”€ add_sources.ts           # ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

data/
â””â”€â”€ repositories/
    â””â”€â”€ EventRepository.ts       # source ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å¯¾å¿œ
```

---

## ãƒ†ã‚¹ãƒˆé …ç›®

| ãƒ†ã‚¹ãƒˆ                 | æ–¹æ³•                            | æœŸå¾…å€¤                      |
| ---------------------- | ------------------------------- | --------------------------- |
| å…¸æ‹ ãƒ‡ãƒ¼ã‚¿             | 100ä»¶ã‚¤ãƒ™ãƒ³ãƒˆã« source è¨­å®š     | source ãŒ JSON ã§ä¿å­˜ã•ã‚Œã‚‹ |
| SourceBadge ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ« | 10px, #718096 è¡¨ç¤º              | å°ãƒ•ã‚©ãƒ³ãƒˆã€ç°è‰²ã§è¦‹ã‚„ã™ã„  |
| URL ã‚¿ãƒƒãƒ—             | source.url ã‚’æŒã¤ã‚¤ãƒ†ãƒ ã‚’ã‚¿ãƒƒãƒ— | ãƒ–ãƒ©ã‚¦ã‚¶ã§ URL ãŒé–‹ã       |
| source ãªã—            | event.source ãŒ null            | ã‚»ã‚¯ã‚·ãƒ§ãƒ³éè¡¨ç¤º            |
| ã‚ªãƒ•ãƒ©ã‚¤ãƒ³             | source ãƒ‡ãƒ¼ã‚¿è¡¨ç¤º               | ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãªã—ã§è¡¨ç¤ºå¯èƒ½  |

---

**ä½œæˆæ—¥:** 2025-01-25
**å„ªå…ˆåº¦:** P1
**æ¨å®šå·¥æ•°:** 1.5d
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:** Not Started
**ãƒ–ãƒ­ãƒƒã‚«ãƒ¼:** 013 (source ãƒ‡ãƒ¼ã‚¿è¨­å®š), 031 (çµ±åˆ)
